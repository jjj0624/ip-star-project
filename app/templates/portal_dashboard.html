{% extends "base.html" %}

{% block content %}
    <div class="text-center mb-5">
        <h2 class="fw-bold">{{ title }}</h2>
        <p class="text-muted">æ¬¢è¿, {{ current_user.username }}ã€‚æ¢ç´¢å¯åˆä½œçš„ IP å½¢è±¡ã€‚</p>
    </div>

    <div class="card my-4 shadow-sm border-0">
        <div class="card-body bg-light rounded">
            <form method="GET" action="{{ url_for('main.portal_dashboard') }}">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">IP åç§°</label>
                        <input type="text" class="form-control" name="q" value="{{ search_query or '' }}" placeholder="è¾“å…¥å…³é”®è¯...">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">ç±»åˆ«</label>
                        <select class="form-select" name="category">
                            <option value="">æ‰€æœ‰ç±»åˆ«</option>
                            {% for category in categories %}
                                <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>{{ category }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">å•†ä¸šä»·å€¼</label>
                        <select class="form-select" name="value_level">
                            <option value="">æ‰€æœ‰ç­‰çº§</option>
                            {% for level in value_levels %}
                                <option value="{{ level }}" {% if level == selected_level %}selected{% endif %}>{{ level }} çº§</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2 align-self-end">
                        <button type="submit" class="btn btn-primary w-100 fw-bold">ğŸ” ç­›é€‰</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
        {% for ip in ips %}
            <div class="col">
                <div class="card h-100 shadow-sm border-0 position-relative overflow-hidden ip-card">

                    {% set status = ip_statuses.get(ip.id, 'æœªçŸ¥') %}
                    {% if 'ä¸å¯è®¸å¯' in status %}
                        <div class="position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
                             style="background: rgba(0,0,0,0.6); z-index: 10; opacity: 0; transition: opacity 0.3s;"
                             onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0">
                            <div class="text-center text-white p-3">
                                <h5 class="fw-bold">æš‚æ—¶æ— æ³•è®¸å¯</h5>
                                <p class="small mb-0">è¯¥ IP å½“å‰å·²æœ‰ç‹¬å åˆä½œ</p>
                                <p class="small">è¯·è”ç³»å•†åŠ¡æ·±å…¥æ²Ÿé€š</p>
                            </div>
                        </div>
                    {% endif %}

                    <img src="{{ url_for('static', filename=ip.image_url) }}" class="card-img-top" alt="{{ ip.name }}" style="height: 250px; object-fit: cover;">

                    <div class="card-body text-center">
                        <h5 class="card-title fw-bold mb-1">{{ ip.name }}</h5>
                        <p class="text-muted small mb-2">{{ ip.category }} | {{ ip.value_level }}çº§</p>

                        {% if 'ä¸å¯è®¸å¯' in status %}
                            <span class="badge bg-secondary">æš‚æ—¶é”å®š</span>
                        {% elif 'ä»¥å¤–' in status %}
                            <span class="badge bg-warning text-dark">åŒºåŸŸå—é™</span>
                        {% else %}
                            <span class="badge bg-success">å¯åˆä½œ</span>
                        {% endif %}
                    </div>

                    <div class="card-footer bg-white border-0 text-center pb-3">
                        <a href="{{ url_for('main.ip_detail', ip_id=ip.id, q=search_query, category=selected_category, value_level=selected_level) }}"
                           class="btn btn-outline-primary rounded-pill px-4">æŸ¥çœ‹è¯¦æƒ…</a>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12 py-5">
                <div class="text-center text-muted">
                    <i class="bi bi-inbox display-4"></i>
                    <p class="mt-3">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ IP å½¢è±¡ã€‚</p>
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="mt-5 pt-5 text-center">
        <hr>
        <h2 class="mb-4 text-primary">IP STAR ä¼™ä¼´åˆä½œé¡¾é—®</h2>
        {% if tencent_embed_url %}
            <a href="{{ tencent_embed_url }}" class="btn btn-primary btn-lg shadow-lg rounded-pill px-5" target="_blank">
                ğŸ’¡ å‰å¾€ ä¼™ä¼´é¡¾é—® èŠå¤©
            </a>
            <p class="text-muted mt-2 small">è·å–ä¸“ä¸šæ¨èä¸è´¹ç”¨æµ‹ç®—</p>
        {% endif %}
    </div>
{% endblock %}