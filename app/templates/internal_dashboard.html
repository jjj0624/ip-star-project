{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <h2 class="mb-4">{{ title }} <span class="badge bg-primary fs-6">å†…æ§è§†è§’</span></h2>

    <div class="row mb-5">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white fw-bold">ğŸ’° IP ç›®å‰æ”¶ç›Š (ä¸‡å…ƒ)</div>
                <div class="card-body"><div id="chart-rev" style="height:300px;"></div></div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white fw-bold">ğŸ”¥ IP å…³æ³¨çƒ­åº¦</div>
                <div class="card-body"><div id="chart-click" style="height:300px;"></div></div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white"><h4>A. èµ„äº§æ•°å­—åŒ–å°è´¦</h4></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead><tr>
                        <th>åç§°</th><th>çº§åˆ«</th><th>æ ‡ç­¾</th><th>ç›®å‰æ”¶ç›Š</th><th>çŠ¶æ€</th><th>æ“ä½œ</th>
                    </tr></thead>
                    <tbody>
                        {% for ip in ips %}
                        <tr>
                            <td class="fw-bold">{{ ip.name }}</td>
                            <td>{{ ip.value_level }}</td>
                            <td>{{ ip.tags }}</td>
                            <td class="text-success fw-bold">Â¥{{ ip.current_revenue }}</td>
                            <td>{{ ip.internal_status }}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#m{{ ip.id }}">æŸ¥çœ‹è¯¦æƒ…</button>
                                <div class="modal fade" id="m{{ ip.id }}" tabindex="-1">
                                    <div class="modal-dialog modal-lg"><div class="modal-content">
                                        <div class="modal-header"><h5 class="modal-title">{{ ip.name }} å…¨è²Œ</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-4"><img src="{{ url_for('static', filename=ip.image_url) }}" class="img-fluid rounded"></div>
                                                <div class="col-8">
                                                    <p><strong>ç™»è®°å·:</strong> {{ ip.reg_number }}</p>
                                                    <p><strong>æƒå±:</strong> {{ ip.ownership }}</p>
                                                    <p><strong>ä½œè€…:</strong> {{ ip.author }}</p>
                                                    <p><strong>å•†æ ‡:</strong> {{ ip.trademark_info }}</p>
                                                    <p><strong>æˆæƒæœŸ:</strong> {{ ip.license_period }}</p>
                                                    <p><strong>è”ç³»:</strong> {{ ip.contact_email }}</p>
                                                    <p class="text-muted">{{ ip.description }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div></div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-header bg-success text-white"><h4>B. åˆåŒç®¡ç†å°è´¦</h4></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead><tr>
                        <th>æ¡ˆä¾‹</th><th>IP</th><th>å“ç‰Œ/ç›¸å¯¹æ–¹</th><th>åœ°åŸŸ</th><th>æ–¹å¼/ç±»åˆ«</th><th>ç±»å‹</th><th>æœ‰æ•ˆæœŸ</th><th>åŸä»¶</th>
                    </tr></thead>
                    <tbody>
                        {% for c in contracts %}
                        <tr>
                            <td>{% if c.case_image_url %}<img src="{{ url_for('static', filename=c.case_image_url) }}" width="40" height="40" class="rounded">{% endif %}</td>
                            <td class="fw-bold">{{ c.ip_asset.name }}</td>
                            <td>{{ c.partner_brand }}<br><small class="text-muted">{{ c.partner_name }}</small></td>
                            <td>{{ c.region }}</td>
                            <td>{{ c.license_method }}<br><small>{{ c.license_category }}</small></td>
                            <td>{{ c.license_type }}</td>
                            <td class="small">{{ c.term_start }}<br>è‡³ {{ c.term_end }}</td>
                            <td>
                                {% if c.pdf_url %}
                                <a href="{{ url_for('static', filename=c.pdf_url) }}" target="_blank" class="btn btn-sm btn-danger">æŸ¥çœ‹åˆåŒ</a>
                                {% else %}<span class="text-muted">æ— </span>{% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {% if tencent_embed_url %}
    <a href="{{ tencent_embed_url }}" target="_blank" class="btn btn-primary btn-lg rounded-pill shadow-lg" style="position:fixed;bottom:20px;right:20px;">ğŸ¤– AI åŠ©æ‰‹</a>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script>
    var cRev = echarts.init(document.getElementById('chart-rev'));
    cRev.setOption({ xAxis:{type:'category',data:{{rev_x|tojson}}}, yAxis:{type:'value'}, series:[{type:'bar',data:{{rev_y|tojson}},itemStyle:{color:'#198754'}}] });
    var cClick = echarts.init(document.getElementById('chart-click'));
    cClick.setOption({ xAxis:{type:'category',data:{{click_x|tojson}}}, yAxis:{type:'value'}, series:[{type:'line',smooth:true,data:{{click_y|tojson}},itemStyle:{color:'#0d6efd'}}] });
</script>
{% endblock %}